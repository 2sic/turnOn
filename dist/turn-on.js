(()=>{"use strict";var t={724:(t,n,r)=>{r.d(n,{sv:()=>O,vQ:()=>f,qb:()=>a,kf:()=>c,nr:()=>b,ef:()=>e,Vp:()=>o,cM:()=>i});var e="turn-on",o="turn-on-skip";function i(t,n,r){r?console.log("turn-on: "+t,n,r):n?console.log("turn-on: "+t,n):console.log("turn-on: "+t)}var s,a=function(t,n,r){void 0===r&&(r="not set"),this.ready=t,this.message=n,this.name=r,this.attempts=0},u=(s=function(t,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}s(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}),c=function(t){function n(n){var r=this;n||(n=[]);var e=function(t){return!!Array.isArray(t)&&t.filter((function(t){return t.ready})).length==t.length}(n),o=0===n.length?"no conditions provided":e?"all ok":"some conditions did not complete";return(r=t.call(this,e,o,"Summary")||this).details=n,r}return u(n,t),n}(a),f=function(){function t(){}return t.prototype.make=function(t){return"function"==typeof t?this.fnChecker(t):"string"==typeof t?this.keyChecker(t):void 0},t.prototype.fnChecker=function(t){var n=t.toString();return n&&n.length>25&&(n=n.substr(0,25)),function(){return{name:n,ready:t(),message:""}}},t.prototype.keyChecker=function(t){if(!t)return function(){return new a(!0,"empty key",t)};var n=t.split(".");return n.length>0&&"window"==n[0]&&n.shift(),0==n.length?function(){return new a(!0,"no keys except maybe windows found",t)}:function(){for(var r=window,e="window",o=0;o<n.length;o++){var i=n[o];if(!(r=r[i]))break;if(e+="."+i,o==n.length-1)return new a(!0,"all keys matched",t)}return new a(!1,"Not all keys matched yet. So far '"+e+"' worked.",t)}},t}(),h="9-error",p=function(){function t(t,n,r){this.tag=t,this.config=n,this.turnOn=r,this.syncDom()}return t.prototype.syncDom=function(){i("syncDom",this);var t=this.tag;t.getAttribute(o)||t.setAttribute(o,"skip");var n=JSON.stringify(this.config);t.getAttribute(e)!==n&&t.setAttribute(e,n)},t.prototype.progress=function(t){this.config.progress=t,this.syncDom()},t.prototype.error=function(t){throw this.config.progress=h,this.config.error=t,this.syncDom(),this.config.error},t}(),l="reject",g="turnOn",d=function(){this.interval=100,this.attempts=100,this.log="error",this.failure=l,this.name=g},y=function(){function t(){}return t.createError=function(t){return{await:[],run:"",progress:h,error:t}},t.load=function(n){var r,e;try{r=JSON.parse(n)}catch(n){return t.createError("detected configuration but cannot parse to json.")}try{e=t.stabilize(r)}catch(n){return t.createError("Error loading configuration, reason unknown.")}return e},t.stabilize=function(n){if(!n)return t.createError("No data found to process");if(!n.run)return t.createError("Configuration didn't contain run - that's the minimum required.");if(!n.run.startsWith("window"))return t.createError("run command must start with 'window.' but is:"+n.run);if(!n.run.endsWith("()"))return t.createError("run must be a function name and end with () but it's:"+n.run);var r=Array.isArray(n.await)?n.await:n.await?[n.await]:[];return r.push(n.run.substring(0,n.run.length-2)),{await:r,run:n.run,progress:"1-loaded",data:n.data}},t}(),w=function(){function t(t){this.root=t,this.tags=new Array}return t.prototype.tryToLoadTag=function(t){var n,r,s=null===(n=null==t?void 0:t.getAttribute)||void 0===n?void 0:n.call(t,e);if(s){var a=null===(r=null==t?void 0:t.getAttribute)||void 0===r?void 0:r.call(t,o);if(i("skip",a),a)return i("skip");i("attr",s);var u=y.load(s);u.progress!==h?(i("stable config"),this.add(t,u)):console.error(u.error,t,s)}},t.prototype.add=function(t,n){i("add",t,n);var r=new p(t,n);this.tags.push(r),function(t,n){var r=n.config;i("convert to turnon");var e=t.new().await(r.await);n.progress("2-watching"),e.then((function(){var t=r.run;i("turn on success - will try to run "+t),n.progress("3-running"),t.endsWith("()")||n.error("run should end with () but doesn't - can't continue");var e=(t=t.substr(0,t.length-2)).split(".");e.length>0&&"window"==e[0]&&e.shift();for(var o=window,s="window",a=0;a<e.length;a++){var u=e[a];s+="."+u,(o=o[u])||n.error("Tried to find object parts for "+s+" but didn't get anything.")}"function"!=typeof o&&n.error("Got "+s+" but it's not a function"),o(m(m({},r),{tag:n})),n.progress("4-completed")}))}(this.root,r)},t.prototype.updateTags=function(){i("updateTags: "+this.tags.length),this.tags.forEach((function(t){return t.syncDom()}))},t}(),m=function(){return(m=Object.assign||function(t){for(var n,r=1,e=arguments.length;r<e;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)};console.log("hello!");var v={attributes:!1,childList:!0,subtree:!0},b=function(){function t(t){this.tagManager=t,this.scanExistingDom()}return t.prototype.scanExistingDom=function(){var t=this;i("scanExistingDom");var n=document.querySelectorAll("[turn-on]");i("tags:",n),n.forEach((function(n){return t.tagManager.tryToLoadTag(n)}))},t.prototype.activateObserver=function(){var t=this;i("load"),new MutationObserver((function(n){i("turnOn mutation"),n.forEach((function(n){"childList"==n.type&&(i("hit children"),n.addedNodes.forEach((function(n){return t.tagManager.tryToLoadTag(n)})))}))})).observe(document.documentElement,v)},t}(),k=function(){return(k=Object.assign||function(t){for(var n,r=1,e=arguments.length;r<e;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},O=function(){function t(t,n){this.lastStatus=new a(!1,"condition not checked yet"),this.attempts=0,this.innerCheck=t,this.settings=n}return t.prototype.innerCheck=function(){return new a(!0,"no condition defined")},t.prototype.check=function(){return this.lastStatus.ready||(this.lastStatus=this.innerCheck()),this.lastStatus},t.prototype.asPromise=function(){var t=this,n=function(r,e){var o=t.check();o.ready?r(k(k({},o),{attempts:t.attempts})):t.attempts++>=t.settings.attempts?r(k(k({},o),{message:"tried up to max attempts: "+o.message,attempts:t.attempts})):setTimeout(n,t.settings.interval,r,e)};return new Promise(n)},t}(),E=function(){return(E=Object.assign||function(t){for(var n,r=1,e=arguments.length;r<e;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},A=function(){function t(n){this.settings=new d,this._conditionMaker=new f,"string"==typeof n&&(n={name:n}),n&&(this.settings=E(E({},this.settings),n)),t.count++}return t.prototype.new=function(n){return new t(n)},t.prototype.await=function(n){var r=this,e=(Array.isArray(n)?n:[n]).map((function(t){if(Promise.resolve(t)===t)return n=t,new Promise((function(t,r){n.then((function(n){t(new a(!1!==n,"from promise"))})).catch((function(t){return r(t)}))}));var n,e=r._conditionMaker.make(t);return new O(e,r.settings).asPromise()})),o=this,i=t.count;return new Promise((function(t,n){Promise.all(e).then((function(r){var e=new c(r);if(("debug"===o.settings.log||!e.ready&&"silent"!==o.settings.log)&&o.logStatusList(i,o.settings,r),e.ready)t(new c(r));else switch(o.settings.failure){case l:n(e);break;case"resolve":t(e);break;case"silent":return}}))}))},t.prototype.logStatusList=function(t,n,r){console.log("turnOn #"+t+" "+(n.name!==g?'"'+n.name+'" ':"")+"couldn't complete because some conditions were not met. See details: ",r)},t.count=0,t}(),j=function(){function t(){this.tagManager=new w(this),this.loader=new b(this.tagManager)}return t.prototype.new=function(t){return new A(t)},t}(),P=window;P.turnOn||(P.turnOn=new j),P.turnOn.loader.activateObserver()}},n={};function r(e){if(n[e])return n[e].exports;var o=n[e]={exports:{}};return t[e](o,o.exports,r),o.exports}r.d=(t,n)=>{for(var e in n)r.o(n,e)&&!r.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:n[e]})},r.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r(724)})();
//# sourceMappingURL=turn-on.js.map